# InnoDB VS MyISAM

### 스토리지 엔진

- 실제 데이터를 디스크 스토리지에 저장하거나 디스크 스토리지로부터 데이터를 읽어오는 부분은 스토리지 엔진이 전담한다.

---

### InnoDB

- **특징**
  - 레코드 기반의 잠금을 제공한다.
    - 높은 동시성 처리가 가능하다.
    - 안정적이다.
    - 성능이 뛰어나다.
  - 프라이머리 키에 의한 클러스터링
    - InnoDB의 모든 테이블은 기본적으로 프라이머리 키를 기준으로 클러스터링 되어 저장된다.
    - 프라이머리 키에 의한 레인지 스캔은 상당히 빨리 처리될 수 있다.
  - 잠금이 필요 없는 일관된 읽기(Non-locking consistent read)
    - MVCC라는 기술을 이용해 락을 걸지 않고 읽기 작업을 수행한다. 락을 걸지 않기 때문에 읽기 작업은 다른 트랜잭션이 가지고 있는 락을 기다리지도 않는다.
  - 외래 키 지원
    - InnoDB 스토리지 엔진 레벨에서 외리 키를 지원한다.
  - 자동 데드락 감지
    - 그래프 기반의 데드락 체크 방식을 사용하기 때문에 데드락이 발생함과 동시에 바로 감지되고, 감지된 데드락은 관련 트랜잭션 중에서 ROLLBACK이 가장 용이한 트랜잭션을 자동적으로 강제 종료한다.
    - 데드락 때문에 쿼리가 제한시간(Timeout)에 도달하거나 슬로우 쿼리로 기록되는 경우는 많지 않다.
  - 자동화된 장애 복구
    - InnoDB에는 손실이나 장애로부터 데이터를 보호하기 위한 여러 가지 메커니즘이 탑재돼 있다.
  - 오라클의 아키텍처 적용
    - InnoDB 스토리지 엔진의 기능은 오라클 DBMS의 기능과 상당히 비슷한 부분이 많다.

- **버퍼 풀**
  - InnoDB 스토리지 엔진에서 가장 핵심적인 부분으로, 디스크의 데이터 파일이나 인덱스 정보를 메모리에 캐시해 두는 공간이다.
  - 쓰기 작업을 지연시켜 일괄 작업으로 처리할 수 있게 해주는 버퍼 역할도 같이 한다.
- **언두(Undo) 로그**
  - 언두 영역은 UPDATE 문장이나 DELETE와 같은 문장으로 데이터를 변경했을 때 변경되기 전의 데이터(이전 데이터)를 보관하는 곳이다.
  - 언두의 데이터는 크게 두 가지 용도로 사용된다.
    1. 트랜잭션의 롤백 대비용
       - 트랜잭션을 커밋하지 않아도 실제 데이터 파일 내용은 변경된다. 그리고 변경되기 전의 값이 백업 된다. 이 상태에서 사용자가 커밋하게 되면 현재 상태가 그대로 유지되고, 롤백하게 되면 언두 영역의 백업된 데이터를 다시 데이터 파일로 복구한다.
    2. 트랜잭션의 격리 수준을 유지하면서 높은 동시성을 제공하는 데 사용된다.
- **MVCC(Multi Version Concurrency Control)**
  - 일반적으로 레코드 레벨의 트랜잭션을 지원하는 DBMS가 제공하는 기능이다.
  - MVCC의 가장 큰 목적은 잠금을 사용하지 않는 일괄된 읽기를 제공하는 데 있다.
    - 언두 로그를 이용해 이 기능을 구현한다.
  - 멀티 버전이라 함은 하나의 레코드에 대해 여러 개의 버전이 동시에 관리된다는 의미다.
- **잠금이 필요 없는 일관된 읽기(Non-locking consistent read)**
  - InnoDB 에서 격리 수준이 SERIALIZABLE일 때를 제외하고 INSERT와 연결되지 않은 SELECT 작업은 다른 트랜잭션의 변경작업과 관계없이 항상 잠금을 대기하지 않고 바로 실행된다.
  - 특정 사용자가 레코드를 변경하고 아직 커밋을 수행하지 않았다 하더라도 이 변경 트랜잭션이 다른 사용자의 SELECT 작업을 방해하지 않는다. 이를 "잠금 없는 일관된 읽기"라고 표현한다.
    - 언두 로그를 사용한다.

---

### MyISAM

- **특징**

  - InnoDB에 비하여 별다른 기능이 없으므로 데이터 모델 디자인이 단순하다.
    - Select 작업 속도가 빠르다

  - Full-text 인덱싱이 가능하여 검색하고자 하는 내용에 대한 복합검색이 가능하다.
  - 데이터 무결성이 보장되지 않는다.
  - 트랜잭션에 대한 지원이 없다.
  - Table-level Lock을 사용한다
    - 쓰기 작업(INSERT, UPDATE) 속도가 느리다.

- **키 캐시**

  - InnoDB의 버퍼 풀과 비슷한 역할을 한다.
  - MyISAM 키 캐시는 인덱스만 대상으로 작동하며 또한 인덱스의 디스크 쓰기 작업에 대해서만 부분적으로 버퍼링 역할을 한다.

---

### 차이점

![db-storage-engine1](https://user-images.githubusercontent.com/66261552/120068342-265d5400-c0bb-11eb-8bdf-18e78b3ffd38.png)

---

### 참고자료

- Real MySQL